{% extends 'subheader.html' %}
{% block content %}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-7 col-md-9">
            <div class="card shadow-lg border-0 rounded-3">
                
                <!-- Orange Header -->
                <div class="card-header text-white text-center" style="background-color: #ff9800;">
                    <h4 class="mb-0"><i class="fas fa-building me-2"></i> Company Registration</h4>
                </div>
                
                <div class="card-body p-4">

                    <!-- Success / Error Messages -->
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-success alert-dismissible fade show" role="alert">
                                <i class="fas fa-check-circle me-2"></i> {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}

                    <!-- Registration Form -->
                    <form method="POST">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            {{ form.as_p }}
                        </div>
                        <div class="mb-3">
                            {{ form1.as_p }}
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-lg text-white" style="background-color: #ff9800;">
                                <i class="fas fa-user-check me-2"></i> Register
                            </button>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Optional CSS for spacing -->
<style>
    .card-header {
        font-weight: bold;
        letter-spacing: 0.5px;
    }
    form p {
        margin-bottom: 1rem;
    }
    label {
        font-weight: 500;
    }
</style>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.querySelector('form[method="POST"]'); // or give it an id and select by #registerForm

  function ensureFeedbackAfter(input) {
    let fb = input.nextElementSibling;
    if (!(fb && fb.matches('small.field-feedback'))) {
      fb = document.createElement('small');
      fb.className = 'field-feedback';
      fb.setAttribute('data-feedback', 'true');
      input.insertAdjacentElement('afterend', fb);
    }
    return fb;
  }

  function wireValidation(input, pattern, validMsg, invalidMsg, requiredMsg = '❌ This field is required') {
    if (!input) return () => true;
    const validate = () => {
      const fb = ensureFeedbackAfter(input);
      const value = (input.value || '').trim();

      if (!value) {
        fb.textContent = requiredMsg;
        fb.classList.remove('ok'); fb.classList.add('error');
        input.classList.remove('is-valid'); input.classList.add('is-invalid');
        return false;
      }
      if (pattern && !pattern.test(value)) {
        fb.textContent = '❌ ' + invalidMsg;
        fb.classList.remove('ok'); fb.classList.add('error');
        input.classList.remove('is-valid'); input.classList.add('is-invalid');
        return false;
      }
      fb.textContent = '✅ ' + validMsg;
      fb.classList.remove('error'); fb.classList.add('ok');
      input.classList.remove('is-invalid'); input.classList.add('is-valid');
      return true;
    };
    input.addEventListener('input', validate);
    input.addEventListener('blur', validate);
    validate();
    return validate;
  }

  // ✅ Scope queries to THIS form (critical fix)
  const vName = wireValidation(
    form.querySelector('input[name="company_name"]'),
    /^[A-Za-z ]+$/, 'Valid name', 'Name must contain only letters and spaces'
  );

  const vContact = wireValidation(
    form.querySelector('input[name="contact"]'),
    /^\d{10}$/, 'Valid phone number', 'Enter a valid 10-digit phone number'
  );

  const vEmail = wireValidation(
    form.querySelector('input[name="email"]'),
    /^[^\s@]+@[^\s@]+\.[^\s@]+$/, 'Valid email address', 'Enter a valid email address'
  );

  const vPassword = wireValidation(
    form.querySelector('input[name="password"]'),
    /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/,
    'Strong password', 'Password must include uppercase, lowercase, number, and special character'
  );

  form.addEventListener('submit', function (e) {
    const results = [vName(), vContact(), vEmail(), vPassword()];
    if (results.includes(false)) {
      e.preventDefault();
      const firstInvalid = ['name','contact','email','password']
        .map(n => form.querySelector(`input[name="${n}"]`))
        .find(inp => inp && inp.classList.contains('is-invalid'));
      if (firstInvalid) firstInvalid.focus();
    }
  });
});
</script>

{% endblock %}
