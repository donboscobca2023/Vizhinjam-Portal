{% extends 'user_subheader.html' %}
{% block content %}

<div class="container my-5">
    <div class="card shadow-lg border-0 rounded-4">
        
        <!-- Header -->
        <div class="card-header text-white" style="background-color: #ff9800;">
            <h4 class="mb-0"><i class="fas fa-ship me-2"></i> Export Registration</h4>
        </div>

        <div class="card-body">
            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="fas fa-check-circle me-2"></i> {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Export Form -->
            <form method="POST">
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-md-6">
                        {{ form.productcategory.label_tag }}
                        {{ form.productcategory }}
                    </div>
                    <div class="col-md-6">
                        {{ form.productname.label_tag }}
                        {{ form.productname }}
                    </div>
                    <div class="col-md-6">
                        {{ form.quantity.label_tag }}
                        {{ form.quantity }}
                    </div>
                    <div class="col-md-6">
                        {{ form.recipientname.label_tag }}
                        {{ form.recipientname }}
                    </div>
                    <div class="col-md-6">
                        {{ form.recipientaddress.label_tag }}
                        {{ form.recipientaddress }}
                    </div>
                    <div class="col-md-6">
                        {{ form.recipientcontact.label_tag }}
                        {{ form.recipientcontact }}
                    </div>
                    <div class="col-md-6">
                        {{ form.recipientemail.label_tag }}
                        {{ form.recipientemail }}
                    </div>
                    <div class="col-md-6">
                        {{ form.source.label_tag }}
                        {{ form.source }}
                    </div>
                    <div class="col-md-6">
                        {{ form.destination.label_tag }}
                        {{ form.destination }}
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-lg px-5 text-white" style="background-color: #ff9800;">
                        <i class="fas fa-save me-2"></i> Register
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(function(){  // DOM ready

    const productChoices = {
        'Electronics': [
            {value: 'Laptop&parts', text: 'Laptop & Parts'},
            {value: 'electronic gadgets', text: 'Electronic Gadgets'},
            {value: 'mobile phones', text: 'Mobile Phones'},
            {value: 'television', text: 'Television'}
        ],
        'Furniture': [
            {value: 'Chair', text: 'Chair'},
            {value: 'Table', text: 'Table'},
            {value: 'sofa', text: 'Sofa'},
            {value: 'bed', text: 'Bed'}
        ]
    };

    function populateProducts(category, selectedValue = '') {
        var productSelect = $("#id_productname");
        productSelect.empty();
        productSelect.append($('<option>', { value: '', text: '--- Select Product ---' }));
        if (category && productChoices[category]) {
            productChoices[category].forEach(function (item) {
                productSelect.append($('<option>', {
                    value: item.value,
                    text: item.text
                }));
            });
            if (selectedValue) {
                productSelect.val(selectedValue);
            }
        }
    }

    // on change populate list
    $("#id_productcategory").on('change', function () {
        populateProducts($(this).val());
    });

    // on page load: if a category already selected (e.g. after validation error), populate and set selected product
    const initialCategory = $("#id_productcategory").val();
    const initialProduct = $("#id_productname").val(); // if server-side __init__ preserved it, this will be the value
    if (initialCategory) {
        populateProducts(initialCategory, initialProduct);
    }
});
</script>

{% endblock %}
